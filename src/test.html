<!DOCTYPE html>
<html>

<head>
    <script src="/socket.io/socket.io.js"></script>

    <title>Cancel Ben Tsardoulias</title>
</head>
<!-- add css with the content being in the center of the page  -->
<style>
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
    }

    .title {
        font-family: ubuntu;
        font-size: large;
        margin-bottom: 50px;
    }

    .counter {
        font-size: 1.5em;
        margin-bottom: 30px;
    }

    button {
        font-size: 1.5em;
        padding: 10px 20px;
        border-radius: 5px;
        border: 1px solid #ccc;
        background-color: #098BDB;
        color: white;
        cursor: pointer;
    }

    button:hover {
        background-color: #0C62AB;
    }

    .buttons-container {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
        max-width: 400px;
    }

    .progress-container {
        width: 100%;
        max-width: 400px;
        margin-bottom: 30px;
    }

    progress {
        width: 100%;
        height: 30px;
        appearance: none;
        border: none;
        border-radius: 5px;
        background-color: #eee;
    }

    progress::-webkit-progress-bar {
        background-color: #eee;
        border-radius: 5px;
    }

    progress::-webkit-progress-value {
        background-color: #098BDB;
        border-radius: 5px;
    }

    /* add mobile version */
    @media only screen and (max-width: 600px) {
        .container {
            height: 100%;
        }

        .title {
            font-size: 1.5em;
        }

        .counter {
            font-size: 1em;
        }

        button {
            font-size: 1em;
        }

    }
</style>

<body onload="fetchCurrentCount()">
    <div class="container">
        <div class="title">
            <h1>CANCEL BEN TSARDOULIAS</h1>
        </div>
        <div class="counter">I have been canceled <span id="counter">0</span> times</div>
        <div class="progress-container">
            <progress id="progress-bar" value="" max="1000000"></progress>
            <span id="progress-percentage" class="progress-percentage"></span>
        </div>

        <div class="buttons-container">
            <button onclick="incrementCounter()">Cancel me</button>
            <button onclick="incrementCounter(5)">Cancel me 5 </button>
            <button onclick="incrementCounter(10)">Cancel me 10</button>
            <button onclick="incrementCounter(25)">Cancel me 25</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // Listen for counterUpdated event from the server
        socket.on('counterUpdated', (data) => {
            document.getElementById('counter').textContent = data.value;

            // Update the progress bar value based on the counter value
            const progressBar = document.getElementById('progress-bar');
            progressBar.value = data.value;

            // Optionally, display the percentage on the progress bar (you'll need CSS for this)
            const percentage = Math.floor((data.value / progressBar.max) * 100);
            percentageSpan.textContent = percentage + "%"; // Using concatenation here

        });

        async function fetchCurrentCount() {
            try {
                const response = await fetch('/current-count');
                const data = await response.json();

                let displayedCount = 0;
                const counterElem = document.getElementById('counter');

                const updateInterval = setInterval(() => {
                    if (displayedCount < data.value) {
                        displayedCount++;
                        counterElem.textContent = displayedCount;
                    } else {
                        clearInterval(updateInterval);
                    }
                }, 10);
            } catch (error) {
                console.error(error);
            }
        }

        async function incrementCounter(amount = 1) {
            socket.emit('incrementCounter', { amount });
        }
    </script>
</body>

</html>